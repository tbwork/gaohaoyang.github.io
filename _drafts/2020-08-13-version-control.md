项目和二方包版本规范

1 版本号说明
版本号的格式为：
x.y.z.a
其中：
- x ：一级版本号，一般为系统性的重构，重新设计，才需要增加此版本号。
- y ：二级版本号，一般为系统内某个模块的大调整，需要增加此版本号，比如新增功能等。
- z ：三级版本号，对于某个模块的业务逻辑的微调，增添加字段等需求。
- a ：四级版本号，对于某一次发布的所有需求，预发未通过验证、或者上生产后，报错回滚后需要修复。该数字表达的是某一次正式发布后，返工的次数。

2 研发流程中的版本生命周期
假设当前某应用xxx-service的版本为：1.0.2.0

- 【明确版本号】明确迭代上线时间，敲定发布版本号：各迭代按照上线时间汇总，比如共有A,B,C三个需求一起开发，A和B需要在2月12日发布，C需要在3月13日发布。那么A和B可以使用版本号1.0.3.0，C使用版本号1.0.4.0。如果有个需求D临时插入，需要在2月20日发布，那么D占用1.0.4.0，C版本升级至1.0.5.0。版本管理统一在北极星中维护：
新增版本：在各个服务的【服务版本】模块中添加。

修改版本：统一入口见：
https://polaris.juqitech.com/apply/service-version

- 【研发阶段】使用SNAPSHOT进行研发：假设敲定的版本号为1.0.3.0，那么xxx-service需要先定义接口，并且将xxx-service-api-1.0.3.0-SNAPSHOT发布到Nexus私服的DEV仓库。DEV仓库权限需要放开。依赖方使用xxx-service-api-1.0.3.0-SNAPSHOT进行研发和自测验证。
- 【测试阶段】使用SNAPSHOT进行测试：共同提交测试后，测试人员进行测试，有问题修改SNAPSHOT包，直至得到一个稳定的SNAPSHOT版本。测试标记为本次迭代验证通过。
- 【预发发布】接口提供方修改主POM中的revision属性为RELEASE版本（子Module自动变更），组长、测试负责CR，当且仅当只有该字段被修改，本次CR才能通过。提供方先发预发，发布后，所有依赖方修改本次的依赖版本，从SNAPSHOT变为RELEASE。此时意味着提供方版本已经经过了测试，是一个正式的稳定版本。同样经过本轮测试人员和小组长CR，通过后，依赖方再发布到预发。
- 【预发验证】当预发验证成功时，直接发布生产。若是预发验证失败，提供方需要升级自己的第四级版本，代表本次需求返工了。然后再根据两种情况做对应的协同：1）若是接口和契约定义无变化，只是业务逻辑发生变更，那么无需通知依赖方升级版本；2）若是接口和契约定义发生变化，那么需要通知依赖方升级版本至最新，比如：xxx-service-api-1.0.3.1。

预发或生产验证失败后，回退到开发，如果提供方和依赖方都需要变更，那么依然需要先从SNAPSHOT做起，直到测试通过后，发预发进行RELEASE化。

3 二方包升级原则
- 尽量不修改字段。
- 尽量向下兼容。
- 如果需要对接口进行大调整，不如新建接口，等老接口逐渐没有流量后，再删除接口。
- 如果以上三种情况无法避免，需要告知依赖方配合升级，走正常的迭代流程进行验证升级。


4 工作模式介绍
- 每个服务的研发者需要负责该服务的版本管理。其他依赖方无需再用老方法——下载别人的代码本地install。如果你发现某个服务当前的版本没有包含对应的类，可要求对方上传到Nexus。
- BFF这种多人修改的项目，由大家指定一人修改即可。打开服务版本管理页面如果发现没有人添加过，都可以添加。如果有人添加了，编辑或者直接使用即可。
- 当某个版本需要带一个新功能时，需要在对应版本的说明里加上。
- 大家可以在群里同步某一次需求对应的接口版本，也可以登录北极星查看。
-  强烈建议整个Code Project的不同模块使用同一个版本号，特殊情况下也要保证主pom和接口pom的一致性。
